<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Repasse TSR</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        const SUPABASE_URL = 'https://aytwhfiovgyzieblsthn.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dHdoZmlvdmd5emllYmxzdGhuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNDY3OTYsImV4cCI6MjA4MzkyMjc5Nn0.qFS_EZT7V9Z5PngraXvdrvpsZCcELnxIC51ab8RZn40'; 
        const supabaseCheck = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function checkSession() {
            const { data: { session } } = await supabaseCheck.auth.getSession();
            if (!session) {
                window.location.href = 'login.html'; // Chuta para fora se não tiver logado
            }
        }
        checkSession();
    </script>
</head>
<body>

    <div class="calculator-card">
        
        <button id="btnLogout" class="btn-logout" title="Sair da conta">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        </button>

        <header class="card-header">
            <h1>Calculadora de Repasse</h1>
            <p>TSR Investimentos</p>
        </header>

        <div class="input-group">
            <label>Valor Bruto (R$)</label>
            <input type="number" id="valorBruto" placeholder="0,00">
        </div>

        <div class="input-group">
            <label>Imposto (%)</label>
            <input type="number" id="imposto" placeholder="Ex: 15" value="15">
        </div>
        
        <button id="btnCalcular" class="cta-button">Calcular Repasse</button>
        
        <div id="resultado" style="margin-top: 20px; text-align: center; font-weight: bold; font-size: 1.2rem;"></div>

    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Instância do Supabase para o Logout
            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

            // --- 1. LÓGICA DO BOTÃO DE SAIR ---
            const btnLogout = document.getElementById('btnLogout');
            if(btnLogout) {
                btnLogout.addEventListener('click', async () => {
                    await supabaseClient.auth.signOut();
                    window.location.href = 'login.html';
                });
            }

            // --- 2. LÓGICA DA CALCULADORA ---
            // (Reimplementei uma lógica básica aqui, ajuste conforme sua necessidade)
            const btnCalcular = document.getElementById('btnCalcular');
            const resultBox = document.getElementById('resultado');

            btnCalcular.addEventListener('click', () => {
                const valor = parseFloat(document.getElementById('valorBruto').value) || 0;
                const tax = parseFloat(document.getElementById('imposto').value) || 0;

                // Exemplo de cálculo: Valor - Imposto
                const liquido = valor - (valor * (tax / 100));

                resultBox.innerText = "Líquido: " + liquido.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                resultBox.style.color = "var(--success)";
            });
        });
    </script>
</body>
</html>